# BUGFIX15 — read_joy3/thorough_test 測試腳本修正

**日期**: 2026-02-22
**影響測試**: read_joy3/thorough_test (+1 PASS)
**基線變更**: 158 → 159 PASS / 16 → 15 FAIL

## 問題分析

`read_joy3/thorough_test.nes` 在測試腳本中有兩個參數錯誤：

### 問題 1: 錯誤的 `--input A:2.0`
- 測試透過 DMC DMA 干擾 joypad 讀取，驗證 `read_joy` 多次讀取容錯機制
- 測試預期所有讀取結果為 0（無按鈕按下），最後以 `jne test_failed` 檢查
- `--input A:2.0` 在 frame ~121 按下 A 按鈕，導致部分迭代讀到 A=pressed → "Failed"
- 此測試不需要任何按鈕輸入

### 問題 2: 超時不足 `--max-wait 30`
- 測試執行 1000 次迭代，每次包含 `sync_dmc` + 可變延遲 + `read_joy`
- 在我們的模擬器上需要 ~36.4 秒完成（frame 2189）
- `--max-wait 30` 導致超時

## 修正

**run_tests_report.sh** 和 **run_tests.sh**:
```bash
# 修正前
run_test "read_joy3" "thorough_test.nes" "--max-wait 30 --input A:2.0"

# 修正後
run_test "read_joy3" "thorough_test.nes" "--max-wait 45"
```

## 驗證

- `read_joy3/thorough_test.nes`: PASS (frame 2189, ~36.4 秒)
- 完整測試: 159 PASS / 15 FAIL / 174 TOTAL
- 無回歸

## 技術備註

- thorough_test 設計目的：驗證 DMC DMA 對 $4016 讀取的干擾不超過 1 次/4 次
- 我們的模擬器因無 DMC DMA cycle stealing（Bug F），讀取永不被干擾
- 測試仍通過（0 次干擾 < 2 的閾值）
